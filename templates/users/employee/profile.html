{% extends 'portal/base.html' %}
{% load static %}

{% block body %}
    <div class="ov-container-center-content">
        <form class="ov-form dv-profile-form" enctype="multipart/form-data" method="POST">
            {% csrf_token %}
            <div class="dk-icon">
                {% if object.profile_pic %}
                    <img id="image-thumbnail" src={{ object.profile_pic.url }}>
                {% else %}
                    {% if object.gender == 'M' %}
                        <img id="image-thumbnail" src='{% static 'img/1.png' %}' alt='man-profile'>
                    {% else %}
                        <img id="image-thumbnail" src='{% static 'img/2.png' %}' alt='woman-profile'>
                    {% endif %}
                {% endif %}
            </div>
            {% for field in form %}
            <div>
                <label>{{ field.label }}</label>
                {% if field.name == "profile_pic" %}
                    {% if object.profile_pic %}
                    <img id="photo-preview" class="dv-photo-preview" src={{ object.profile_pic.url }}>
                {% else %}
                    {% if object.gender == 'M' %}
                        <img id="photo-preview" class="dv-photo-preview" src='{% static 'img/1.png' %}' alt='man-profile'>
                    {% else %}
                        <img id="photo-preview" class="dv-photo-preview" src='{% static 'img/2.png' %}' alt='woman-profile'>
                    {% endif %}
                {% endif %}
                {% endif %}

                {{ field }}
            </div>
            {% if field.errors %}
                <div>
                    {{ field.errors }}
                </div>
            {% endif %}
        {% endfor %}
            <div class="ov-form__btn-container">
                <button class="ov-form__btn" type="submit">Potvrdi</button>
                <a class="ov-form__btn ov-form__btn--blue" onclick="showPasswordChangeModal()">Promjena Å¡ifre</a>
            </div>
        </form>
    </div>
    <script>
    function changeThumbnail(){
        document.getElementById('id_profile_pic').addEventListener("change", function(e){
            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('photo-preview').src = e.target.result;

                console.log(e.target.result)
                console.log(document.getElementById('image-thumbnail').src)
            };
            reader.readAsDataURL(this.files[0]);
        })
    }

    function  docReady(fn){
        if(document.readyState === "complete" || document==="interactive"){
            setTimeout(fn,1);
        }else{
            document.addEventListener("DOMContentLoaded",fn);
        }
    }

    docReady(changeThumbnail);
    </script>
{% endblock %}